<%= render 'shared/flash_message' %>
<%= render 'shared/plot_menu', { plot: @plot } %>

<div class="bg-base-200 min-h-screen">
  <div class="grid grid-cols-1">
    <div class="m-2 col-span-1 grid grid-cols-3 shadow-xl <%= render "shared/plot_color", { plot: @plot } %>">
      <label for="my-modal" class="btn btn-ghost col-span-1 ">new card</label>
      <div class="flex col-span-1 ">
        <label class="label cursor-pointer">
          <span class="label-text">感情値グラフ</span> 
          <input type="checkbox" class="toggle" checked onclick="document.getElementById('card').classList.toggle('hidden')"/>
        </label>
      </div>
      <div class="flex col-span-1 ">
        <label class="label cursor-pointer">
          <span class="label-text">伏線グラフ</span> 
          <input type="checkbox" class="toggle" checked onclick="document.getElementById('foreshadowing').classList.toggle('hidden')"/>
        </label>
      </div>
    </div>
    <div class="m-2 pr-2 col-span-1 shadow-xl <%= render "shared/plot_color", { plot: @plot } %>">
      <div id="foreshadowing" class="hidden col-span-1">
        <div class="text-2xl m-2">伏線グラフ</div>
        <%= content_tag :div, "", id: "graph", data: { foreshadowings: @cards_json_foreshadowing || '[]' } %>
        <%= vite_javascript_tag 'card.tsx' %>
      </div> 
    </div>
    <div class="m-2 pr-2 col-span-1 shadow-xl <%= render "shared/plot_color", { plot: @plot } %>">
      <div id="card" class="hidden col-span-1">
      <div class="text-2xl m-2">感情値グラフ</div>
        <%= content_tag :div, "", id: "root", data: { cards: @cards_json || '[]' } %>
        <%= vite_javascript_tag 'board.tsx' %>
      </div>
    </div>
  </div>

  <input type="checkbox" id="my-modal" class="modal-toggle" />
  <label for="my-modal" class="modal cursor-pointer">
    <label class="modal-box relative" for="">
      <label for="my-modal" class="btn btn-sm btn-circle absolute right-2 top-2">✕</label>
      <%= render 'cards/form', { card: @card } %>
    </label>
  </label>
  <div class="m-2">
    <% if @cards.present? %>
      <% cards_by_act = @cards.group_by { |card| card.scene > 30 ? "ACT THREE" : card.scene > 20 ? "ACT TWO 2" : card.scene > 10 ? "ACT TWO 1" : "ACT ONE" } %>
      <% cards_by_act.each do |act, cards| %>
        <div class="text-2xl"><%= act %></div>
        <div class="carousel rounded-box">
          <%= render partial: "cards/card", collection: cards %>
        </div>
      <% end %>
    <% end %>
  </div>
</div>

